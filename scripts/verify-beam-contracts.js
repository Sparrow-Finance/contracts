const hre = require("hardhat");

async function main() {
  console.log("üîç Verifying Beam Testnet Contracts...\n");

  // Contract addresses
  const SPBEAM_PROXY = process.env.BEAM_V2_PROXY || "0x4d3F457c9a6Fd430F661283d92b9E7aA8ae638B8";
  const SPBEAM_IMPL = process.env.BEAM_V2_IMPLEMENTATION || "0xC54f630370aD9Ad9855bEf2932425888D307Ccad";
  const VALIDATOR_HELPER_PROXY = process.env.BEAM_VALIDATOR_HELPER || "0xD0860B697825b80C6Cf21aB0Bb9B02A1Dc672F83";
  const VALIDATOR_HELPER_IMPL = process.env.BEAM_VALIDATOR_HELPER_IMPL || "0x30C2Ad81ce324dAe1CbE9B7F485716f984433AF8";

  console.log("üìç Contracts to verify:");
  console.log("   spBEAM_V2 Proxy:", SPBEAM_PROXY);
  console.log("   spBEAM_V2 Implementation:", SPBEAM_IMPL);
  console.log("   Validator Helper Proxy:", VALIDATOR_HELPER_PROXY);
  console.log("   Validator Helper Implementation:", VALIDATOR_HELPER_IMPL);
  console.log("");

  // Verify spBEAM_V2 Implementation
  console.log("‚è≥ Verifying spBEAM_V2 Implementation...");
  try {
    await hre.run("verify:verify", {
      address: SPBEAM_IMPL,
      constructorArguments: [],
      contract: "contracts/ERC4626/spBEAM_V2.sol:spBEAM_V2"
    });
    console.log("‚úÖ spBEAM_V2 Implementation verified!");
  } catch (error) {
    if (error.message.includes("Already Verified")) {
      console.log("‚úÖ spBEAM_V2 Implementation already verified!");
    } else {
      console.log("‚ùå Error verifying spBEAM_V2 Implementation:", error.message);
    }
  }

  console.log("");

  // Verify spBEAM_V2 Proxy
  console.log("‚è≥ Verifying spBEAM_V2 Proxy...");
  try {
    await hre.run("verify:verify", {
      address: SPBEAM_PROXY,
      constructorArguments: []
    });
    console.log("‚úÖ spBEAM_V2 Proxy verified!");
  } catch (error) {
    if (error.message.includes("Already Verified")) {
      console.log("‚úÖ spBEAM_V2 Proxy already verified!");
    } else {
      console.log("‚ö†Ô∏è  Proxy verification skipped (auto-generated by OpenZeppelin)");
    }
  }

  console.log("");

  // Verify Validator Helper Implementation
  console.log("‚è≥ Verifying Validator Helper Implementation...");
  try {
    await hre.run("verify:verify", {
      address: VALIDATOR_HELPER_IMPL,
      constructorArguments: [],
      contract: "contracts/ERC4626Validator/spBeam_Validator_Helper.sol:spBeam_Validator_Helper"
    });
    console.log("‚úÖ Validator Helper Implementation verified!");
  } catch (error) {
    if (error.message.includes("Already Verified")) {
      console.log("‚úÖ Validator Helper Implementation already verified!");
    } else {
      console.log("‚ùå Error verifying Validator Helper Implementation:", error.message);
    }
  }

  console.log("");

  // Verify Validator Helper Proxy
  console.log("‚è≥ Verifying Validator Helper Proxy...");
  try {
    await hre.run("verify:verify", {
      address: VALIDATOR_HELPER_PROXY,
      constructorArguments: []
    });
    console.log("‚úÖ Validator Helper Proxy verified!");
  } catch (error) {
    if (error.message.includes("Already Verified")) {
      console.log("‚úÖ Validator Helper Proxy already verified!");
    } else {
      console.log("‚ö†Ô∏è  Proxy verification skipped (auto-generated by OpenZeppelin)");
    }
  }

  console.log("\nüéâ Verification complete!");
  console.log("\nüìù View contracts on explorer:");
  console.log("   spBEAM_V2:", `https://subnets-test.avax.network/beam/address/${SPBEAM_PROXY}`);
  console.log("   Validator Helper:", `https://subnets-test.avax.network/beam/address/${VALIDATOR_HELPER_PROXY}`);
}

main()
  .then(() => process.exit(0))
  .catch((error) => {
    console.error("‚ùå Verification failed:", error);
    process.exit(1);
  });
